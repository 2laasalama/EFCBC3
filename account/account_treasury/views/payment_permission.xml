<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <record id="view_payment_permission_form" model="ir.ui.view">
        <field name="name">view.payment.permission.form</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_form"/>
        <field name="mode">primary</field>
        <field name="arch" type="xml">

            <xpath expr="//form" position="attributes">
                <attribute name="create">0</attribute>
                <attribute name="delete">0</attribute>
                <attribute name="edit">0</attribute>
            </xpath>

            <xpath expr="//header" position="replace">
                <header>
                    <field name="state" invisible="1"/>
                    <button name="action_confirm" string="Confirm" class="oe_highlight"
                            attrs="{'invisible': [('payment_order_state', '!=', 'draft')]}" type="object"/>
                    <button name="action_cancel" string="Cancel"
                            attrs="{'invisible': [('payment_order_state', '!=', 'draft')]}" type="object"/>
                    <field name="payment_order_state" widget="statusbar" statusbar_visible="draft,posted"/>
                </header>
            </xpath>


            <xpath expr="//button[@name='button_open_journal_entry']" position="attributes">
                <attribute name="attrs">{'invisible': [('payment_order_state', '!=', 'posted')]}</attribute>
            </xpath>


            <xpath expr="//field[@name='is_internal_transfer']" position="after">
                <field name="payment_permission_num"/>
            </xpath>

            <xpath expr="//field[@name='partner_bank_id']" position="after">
                <field name="is_payment_order" invisible="1"/>
                <field name="type"/>
            </xpath>

            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="string">Vendor</attribute>
            </xpath>

            <xpath expr="//field[@name='partner_bank_id']" position="attributes">
                <attribute name="string">Vendor Bank Account</attribute>
            </xpath>


            <xpath expr="//field[@name='destination_journal_id']" position="after">
                <label for="has_expense" string="Has Expense"/>
                <div>
                    <field name="has_expense" class="oe_inline" widget="boolean_toggle"/>
                    <button class="oe_inline" icon="fa-arrow-right" attrs="{'invisible':[('has_expense','=',False)]}"
                            name="open_expense_sheet"
                            type="object" string="Open Expenses"/>
                </div>
            </xpath>


        </field>
    </record>

    <record id="view_payment_permission_tree" model="ir.ui.view">
        <field name="name">view.payment.permission.tree</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_tree"/>
        <field name="mode">primary</field>
        <field name="arch" type="xml">

            <xpath expr="//tree" position="attributes">
                <attribute name="create">0</attribute>
                <attribute name="delete">0</attribute>
                <attribute name="edit">0</attribute>
            </xpath>

            <xpath expr="//field[@name='date']" position="after">
                <field name="payment_order_num"/>
                <field name="payment_permission_num"/>
            </xpath>

        </field>
    </record>

    <record id="action_payment_permission" model="ir.actions.act_window">
        <field name="name">Payment Permission</field>
        <field name="res_model">account.payment</field>
        <field name="view_mode">tree,kanban,form,graph</field>
        <field name="view_ids" eval="[
            (5, 0, 0),
            (0, 0, {'view_mode': 'tree','view_id': ref('view_payment_permission_tree')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('view_payment_permission_form')})]"/>
        <field name="domain">[('is_payment_order','=', True)]</field>
        <field name="context">{ 'default_is_payment_order': 1,
            'default_move_journal_types': ('bank', 'cash')}
        </field>
    </record>


    <menuitem id="payment_permission_menu" name="Payment Permission"
              parent="account_treasury.account_treasury_root_menu"
              action="action_payment_permission"
              sequence="2"/>
</odoo>
